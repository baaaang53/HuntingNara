<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>$$헌팅나라$$</title>

    <!-- bootstrap including jquery -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- javascript -->
    <script type="text/javascript">
        // 회원가입 - 아이디 중복 검사
        function checkId() {
            $.ajax({
                type: 'post',
                url: '/user/checkId',
                data: {
                    id: $('#id').val()
                },
                success: function(data, status) {
                    if (data.duplicated) {
                        alert('이미 존재하는 아이디입니다');
                        $('#id').val('')
                    } else {
                        alert('사용할 수 있는 아이디입니다');
                        $('#id').prop('readonly', true);
                    }
                },
                error: function(error) {
                    console.log(error)
                }
            });
        }

        function moreInfo() {
            if ($('#freelancer')[0].checked) {
                $('fieldset.additional_form').show();
                $('fieldset.additional_form input').prop('required', true);
                $('#portfolio_form').show();
                $('#portfolio_form input[type="file"]').prop('required', true);
            } else {
                $('fieldset.additional_form').hide();
                $('fieldset.additional_form input').prop('required', false);
                $('#portfolio_form').hide();
                $('#portfolio_form input[type="file"]').prop('required', false);
            }
        }

        function addLanguage() {
            $('fieldset.additional_form').append('&emsp;언어: <input type="text" name="language"> 능숙도(0~5): <input type="number" name="competence" min="0" max="5"><br><br>');
        }

        function submitForm() {
            if (!$('#id').prop('readonly')) {
                alert('아이디 중복검사를 해주세요');
                return false;
            } else {
                $('#portfolio_form input[type="text"]').val($('#id').val());

                $.ajax({
                    type: 'post',
                    url: '/user/register',
                    data: $('#register').serialize(),
                    success: function(data, status) {
                        if (data.success) {
                            alert('회원가입이 완료되었습니다');
                            location.href = '../';
                        } else {
                            alert('회원가입이 완료되지 않았습니다');
                            location.href = './register';
                        }
                    },
                    error: function(error) {
                        console.log(error);
                        alert('회원가입이 완료되지 않았습니다');
                        location.href = './register';
                    }
                });
            }
        }

    </script>
</head>
<body>
    <div class="register_form">
        <h1>&emsp;&emsp;회원가입</h1><br><br>
        <form id="register"> <!--action="/user/register" method="post" enctype="multipart/form-data" onsubmit="submitForm();"-->
            &emsp;회원유형:
            <input type="radio" name="type" value="client" onchange="moreInfo();" required>의뢰인
            <input type="radio" name="type" id="freelancer" value="freelancer" onchange="moreInfo();">프리랜서<br><br>
            &emsp;아이디:
            <input type="text" name="id" id="id" required><br><br>
            &emsp;<input type="button" value="중복검사" onclick="checkId();"><br><br>
            &emsp;비밀번호:
            <input type="password" name="pw" id="pw" required><br><br>
            &emsp;이름:
            <input type="text" name="name" required><br><br>
            &emsp;휴대폰:
            <input type="phone" name="phone" placeholder="'-'를 제외한 숫자만 입력하세요" required><br><br>
            <fieldset class="additional_form" form="register" hidden>
                &emsp;나이:
                <input type="number" name="age" min="0" max="200"><br><br>
                &emsp;개발 경력(년):
                <input type="number" name="career" min="0" max="200"><br><br>
                &emsp;전공 학과:
                <input type="text" name="major"><br><br>
                &emsp;언어별 능숙도<br><br>
                &emsp;언어:
                <input type="text" name="language">
                &emsp;능숙도(0~5):
                <input type="number" name="competence" min="0" max="5">
                <input type="button" value="언어 추가하기" onclick="addLanguage();"><br><br>
            </fieldset>
            <input type="text" name="portfolio" id="portfolio" hidden>
        </form>
        <form id="portfolio_form" method="post" enctype="multipart/form-data" action="/upload/portfolio" onsubmit="submitForm();">
            &emsp;포트폴리오:
            <input type="file" name="portfolio"><br><br>
            <input type="text" name="id" hidden>
            <input type="submit" value="가입하기">
        </form>
    </div>
</body>
</html>